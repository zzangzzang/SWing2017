package com.example.yoon.swing;import android.content.Intent;import android.database.Cursor;import android.database.sqlite.SQLiteDatabase;import android.graphics.Color;import android.os.Bundle;import android.os.Environment;import android.os.Handler;import android.os.Message;import android.support.v7.app.AppCompatActivity;import android.text.SpannableString;import android.text.style.RelativeSizeSpan;import android.util.Log;import android.util.TypedValue;import android.view.MotionEvent;import android.view.View;import android.widget.FrameLayout;import android.widget.ImageButton;import android.widget.ImageView;import android.widget.LinearLayout;import android.widget.TextView;import android.widget.Toast;import android.widget.VideoView;import java.io.File;import java.text.SimpleDateFormat;import java.util.ArrayList;import java.util.Calendar;import java.util.Timer;import java.util.TimerTask;import static android.view.View.INVISIBLE;import static android.view.View.VISIBLE;import static java.lang.Math.abs;public class ResultActivity extends AppCompatActivity {    VideoView videoView, provideoView;    FrameLayout frameLayout, video_layout;    LinearLayout main_layout, linear_video;    LineView lineView1, lineView2;    boolean show1 = false, show2 = false;    ArrayList<ArrayList<Integer>> dataLists1, dataLists2;    ArrayList<Integer> right_weight, left_weight;    ArrayList<Integer> pro_right_weight, pro_left_weight;    ImageButton right_arrow, left_arrow;    String ymd;    int FLAG;    int SEQ;    int CLUB;    MyDBHandler dbHandler;    Cursor cursor;    String query;    TextView textView;    int sync_total;    final static int REPEAT = 1;    ArrayList<Integer> pro_repeat_list;    public static int[] sync_list;    ImageView imgLeft;    ImageView imgRight;    TextView textLeft;    TextView textRight;    TimerTask timerTask;    Timer timer;    TimerTask timerTaskPro;    Timer timerPro;    ImageView imgLeftPro;    ImageView imgRightPro;    TextView textLeftPro;    TextView textRightPro;    int sizeLeftPro;    int sizeRightPro;    int index;    int indexPro;    int sizeLeft;    int sizeRight;    LinearLayout.LayoutParams paramsL;    LinearLayout.LayoutParams paramsR;    @Override    protected void onCreate(Bundle savedInstanceState) {        super.onCreate(savedInstanceState);        setContentView(R.layout.activity_result);        imgRight = (ImageView) findViewById(R.id.imgleft);        imgLeft = (ImageView) findViewById(R.id.imgright);        textRight = (TextView) findViewById(R.id.textleft);        textLeft = (TextView) findViewById(R.id.textright);        imgRightPro = (ImageView) findViewById(R.id.pro_left);        imgLeftPro = (ImageView) findViewById(R.id.pro_right);        textRightPro = (TextView) findViewById(R.id.textleft2);        textLeftPro = (TextView) findViewById(R.id.textright2);        textView = (TextView) findViewById(R.id.synctext);        right_arrow = (ImageButton) findViewById(R.id.right_arrow);        left_arrow = (ImageButton) findViewById(R.id.left_arrow);        right_weight = new ArrayList<>();        left_weight = new ArrayList<>();        pro_right_weight = new ArrayList<>();        pro_left_weight = new ArrayList<>();        Intent intent = getIntent();        dbHandler = new MyDBHandler(this, null, null, 1);        frameLayout = (FrameLayout) findViewById(R.id.activity_result);        video_layout = (FrameLayout) findViewById(R.id.video_layout);        main_layout = (LinearLayout) findViewById(R.id.main_layout);        linear_video = (LinearLayout) findViewById(R.id.linear_video);        SettingBackground();        ymd = intent.getStringExtra("YMD");        FLAG = intent.getIntExtra("FLAG", -1);        SEQ = intent.getIntExtra("SEQ", -1);        CLUB = intent.getIntExtra("CLUB", -1);        sync_list = new int[]{65, 70, 56, 48, 57};        if(FLAG == REPEAT)            index = (SEQ-1)*10-1;        else if(FLAG == 0)            index = -1;        if (FLAG == REPEAT) {            right_arrow.setVisibility(VISIBLE);            left_arrow.setVisibility(VISIBLE);            query = "select * from TBL_TRANNING_DETAIL where TRAINING_SEQ = \'T20170613163502\'";            SQLiteDatabase db = dbHandler.getWritableDatabase();            cursor = db.rawQuery(query, null);            cursor.moveToFirst();            for (int i = 0; i < cursor.getCount(); i++) {                right_weight.add(Integer.parseInt(cursor.getString(3))); // 여기서 왼오 무게확인                left_weight.add(Integer.parseInt(cursor.getString(4))); // 여기서 확인                Log.d("MY RIGHT : ", String.valueOf(right_weight.get(i)));                cursor.moveToNext();            }            /////////////////////////////선수 데이터 set///////////////////////////////////            query = "select * from TBL_PRO_DATA_DETAIL where PRO_ID = \'p00001\'";            cursor = db.rawQuery(query, null);            cursor.moveToFirst();            for (int i = 0; i < cursor.getCount(); i++) {                pro_right_weight.add(Integer.parseInt(cursor.getString(2))); // 여기서 왼오 무게확인                pro_left_weight.add(Integer.parseInt(cursor.getString(3))); // 여기서 확인                Log.d("RPO RIGHT : ", String.valueOf(pro_right_weight.get(i)));                cursor.moveToNext();            }            ////////////////////////////////////////////////////////////////////////////////////////////            CalSync();            //            SpannableString syncText = new SpannableString(String.valueOf(sync_list[SEQ - 1]) + "%");            //            syncText.setSpan(new RelativeSizeSpan(0.6f),2,3,0);            //            textView.setText(syncText);        } else if (FLAG == 0) {            right_arrow.setVisibility(INVISIBLE);            left_arrow.setVisibility(INVISIBLE);            ///// 내 데이터 set //////////////////////////////////////////////////////////            query = "select * from TBL_TRANNING_DETAIL where TRAINING_SEQ = \'" + ymd + "\'";            //            Log.d("MY QUERY : ", query);            SQLiteDatabase db = dbHandler.getWritableDatabase();            cursor = db.rawQuery(query, null);            cursor.moveToFirst();            for (int i = 0; i < cursor.getCount(); i++) {                right_weight.add(Integer.parseInt(cursor.getString(3))); // 여기서 왼오 무게확인                left_weight.add(Integer.parseInt(cursor.getString(4))); // 여기서 확인                Log.d("MY RIGHT : ", String.valueOf(right_weight.get(i)));                cursor.moveToNext();            }            //////////////////////////////////////////////////////////////////////////////            /////////////////////////////선수 데이터 set///////////////////////////////////            query = "select * from TBL_PRO_DATA_DETAIL where PRO_ID = \'p00001\'";            cursor = db.rawQuery(query, null);            cursor.moveToFirst();            for (int i = 0; i < cursor.getCount(); i++) {                pro_right_weight.add(Integer.parseInt(cursor.getString(2))); // 여기서 왼오 무게확인                pro_left_weight.add(Integer.parseInt(cursor.getString(3))); // 여기서 확인                Log.d("RPO RIGHT : ", String.valueOf(pro_right_weight.get(i)));                cursor.moveToNext();            }            ////////////////////////////////////////////////////////////////////////////////////////////            CalSync();        }        //flag = intent.getIntExtra("FLAG", -1);        videoView = (VideoView) findViewById(R.id.videoView);        lineView1 = (LineView) findViewById(R.id.line_view);        lineView1.setDrawDotLine(true); //optional        lineView1.setShowPopup(LineView.SHOW_POPUPS_NONE); //optional        dataset1();        lineView1.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View v) {                if (show1 == false) {                    lineView1.setShowPopup(lineView1.SHOW_POPUPS_All);                    show1 = true;                } else {                    lineView1.setShowPopup(lineView1.SHOW_POPUPS_NONE);                    show1 = false;                }            }        });        int[] colorArray = {Color.parseColor("#e74c3c"), Color.parseColor("#111111")};        lineView1.setColorArray(colorArray);        lineView1.setDataList(dataLists1); //or lineView.setFloatDataList(floatDataLists)        lineView1.setDataOfAGird(40);        lineView2 = (LineView) findViewById(R.id.line_view2);        lineView2.setDrawDotLine(true); //optional        lineView2.setShowPopup(LineView.SHOW_POPUPS_NONE); //optional        dataset2();        lineView2.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View v) {                if (show2 == false) {                    lineView2.setShowPopup(lineView2.SHOW_POPUPS_All);                    show2 = true;                } else {                    lineView2.setShowPopup(lineView2.SHOW_POPUPS_NONE);                    show2 = false;                }            }        });        int[] colorArray2 = {Color.parseColor("#2980b9"), Color.parseColor("#111111")};        lineView2.setColorArray(colorArray2);        lineView2.setDataList(dataLists2); //or lineView.setFloatDataList(floatDataLists)        lineView2.setDataOfAGird(40);        ////////////////////////////        String CAPTURE_TITLE;        CAPTURE_TITLE = ymd + ".3gp"; // 여기서 이름만 바꿔주면 특정 동영상 실행가능 넘겨받아야함        Toast.makeText(this, ymd, Toast.LENGTH_SHORT).show();        File file = new File(Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_DCIM), CAPTURE_TITLE);        if (!file.exists()) {            if (CLUB == 1)                CAPTURE_TITLE = "practice_first.mp4";            else                CAPTURE_TITLE = "practice_seven.mp4";            file = new File(Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_DCIM), CAPTURE_TITLE);        }        videoView.setVideoPath(file.getPath());        videoView.start();        /////////////////////////////        videoView.setOnTouchListener(new View.OnTouchListener() {            @Override            public boolean onTouch(View view, MotionEvent motionEvent) {                //                String CAPTURE_TITLE = "test.3gp"; // 여기서 이름만 바꿔주면 특정 동영상 실행가능 넘겨받아야함                //                File file = new File(Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_DCIM), CAPTURE_TITLE);                //                //                videoView.setVideoPath(file.getPath());                //                 videoView.start();                return false;            }        });        right_arrow.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View view) {                if (SEQ == 5)                    ;                else {                    Intent intent1 = new Intent(ResultActivity.this, ResultActivity.class);                    intent1.putExtra("YMD", "T" + ymd);                    intent1.putExtra("FLAG", 1);                    intent1.putExtra("SEQ", SEQ + 1);                    Log.d("SEQQQQQQQQQQQQQQ", (String.valueOf(SEQ + 1)));                    startActivity(intent1);                    finish();                }            }        });        left_arrow.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View view) {                if (SEQ == 1)                    ;                else {                    Intent intent1 = new Intent(ResultActivity.this, ResultActivity.class);                    intent1.putExtra("YMD", "T" + ymd);                    intent1.putExtra("FLAG", 1);                    intent1.putExtra("SEQ", SEQ - 1);                    Log.d("SEQQQQQQQQQQQQQQ", (String.valueOf(SEQ - 1)));                    startActivity(intent1);                    finish();                }            }        });        feetChange();        if(FLAG == 0)            timer.schedule(timerTask,0,100);        else if(FLAG == REPEAT)            timer.schedule(timerTask,0,500);        indexPro = -1;        timerPro = new Timer();        timerTaskPro = new TimerTask() {            @Override            public void run() {                indexPro++;                setImageSize(1);            }        };    }    public void CalSync() {        int SIZE = 50;        double right_sum = 0, left_sum = 0;        if (FLAG == REPEAT) { /// 반복            int j = 0;            for (int i = (10 * (SEQ - 1)); i < (10 * SEQ); i++) {                right_sum += (double) ((100 * (pro_right_weight.get(j) - abs(pro_right_weight.get(j) - right_weight.get(i)))) / pro_right_weight.get(j));                left_sum += (double) ((100 * (pro_left_weight.get(j) - abs(pro_left_weight.get(j) - left_weight.get(i)))) / pro_left_weight.get(j));                j += 5;            }            sync_total = (int) (right_sum + left_sum) / 100;            Log.d("TOTAL : ", String.valueOf(sync_total));        } else {            for (int i = 0; i < SIZE; i++) {                right_sum += (double) ((100 * (pro_right_weight.get(i) - abs(pro_right_weight.get(i) - right_weight.get(i)))) / pro_right_weight.get(i));                left_sum += (double) ((100 * (pro_left_weight.get(i) - abs(pro_left_weight.get(i) - left_weight.get(i)))) / pro_left_weight.get(i));            }            sync_total = (int) (right_sum + left_sum) / 100;            Log.d("TOTAL : ", String.valueOf(sync_total));        }        if (FLAG == REPEAT) {            sync_total += 65;        }        SpannableString syncText = new SpannableString(sync_total + "%");        syncText.setSpan(new RelativeSizeSpan(0.6f), 2, 3, 0);        textView.setText(syncText);    }    public void SettingBackground() {        Calendar calNow;        calNow = Calendar.getInstance();        String strDateFormat = "HH";        SimpleDateFormat sdf = new SimpleDateFormat(strDateFormat);        String hour_string = sdf.format(calNow.getTime());        int hour = Integer.parseInt(hour_string);        Log.d("HOUR : ", hour_string);        if (hour >= 6 && hour < 14 && MainActivity.ThemaType == 0 || MainActivity.ThemaType == 1) {            frameLayout.setBackgroundResource(R.drawable.mainback3);        } else if (hour >= 14 && hour < 18 && MainActivity.ThemaType == 0 || MainActivity.ThemaType == 2) {            frameLayout.setBackgroundResource(R.drawable.back22);        } else if ((hour >= 18 || hour < 6 && MainActivity.ThemaType == 0) || MainActivity.ThemaType == 3) {            frameLayout.setBackgroundResource(R.drawable.back32);        }    }    void dataset1() {        ArrayList<String> strList = new ArrayList<>();        strList.add("1");        strList.add("2");        strList.add("3");        strList.add("4");        strList.add("5");        strList.add("6");        strList.add("7");        strList.add("8");        strList.add("9");        strList.add("10");        lineView1.setBottomTextList(strList);        lineView1.setColorArray(new int[]{Color.BLACK, Color.GRAY});        dataLists1 = new ArrayList<>();        ArrayList<Integer> intlist = new ArrayList<>();        if (FLAG == REPEAT) {            for (int i = (10 * (SEQ - 1)); i < (10 * SEQ); i++) {                intlist.add(right_weight.get(i));            }        } else {            for (int i = 0; i < 50; i++) {                if (i % 5 == 0) {                    intlist.add(right_weight.get(i));                }            }        }        dataLists1.add(intlist);        ArrayList<Integer> intlist2 = new ArrayList<>();        for (int i = 0; i < 50; i++) {            if (i % 5 == 0) {                intlist2.add(pro_right_weight.get(i));            }        }        dataLists1.add(intlist2);    }    void dataset2() {        ArrayList<String> strList = new ArrayList<>();        strList.add("1");        strList.add("2");        strList.add("3");        strList.add("4");        strList.add("5");        strList.add("6");        strList.add("7");        strList.add("8");        strList.add("9");        strList.add("10");        lineView2.setBottomTextList(strList);        lineView2.setColorArray(new int[]{Color.BLACK, Color.GRAY});        dataLists2 = new ArrayList<>();        ArrayList<Integer> intlist = new ArrayList<>();        if (FLAG == REPEAT) {            for (int i = (10 * (SEQ - 1)); i < (10 * SEQ); i++) {                intlist.add(left_weight.get(i));            }        } else {            for (int i = 0; i < 50; i++) {                if (i % 5 == 0) {                    intlist.add(left_weight.get(i));                }            }        }        dataLists2.add(intlist);        ArrayList<Integer> intlist2 = new ArrayList<>();        for (int i = 0; i < 50; i++) {            if (i % 5 == 0) {                intlist2.add(pro_left_weight.get(i));            }        }        dataLists2.add(intlist2);    }    @Override    public void onBackPressed() {        super.onBackPressed();        finish();    }    public void showVideo(View view) {        videoView.pause();        videoView.setVisibility(INVISIBLE);        main_layout.setAlpha((float) 0.3);        video_layout.setVisibility(VISIBLE);        linear_video.setVisibility(VISIBLE);        provideoView = (VideoView) findViewById(R.id.provideoView);        String CAPTURE_TITLE;        if (CLUB == 1)            CAPTURE_TITLE = "first_iron.mp4";        else            CAPTURE_TITLE = "seven_iron.mp4";// 여기서 이름만 바꿔주면 특정 동영상 실행가능 넘겨받아야함        Toast.makeText(this, ymd, Toast.LENGTH_SHORT).show();        File file = new File(Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_DCIM), CAPTURE_TITLE);        provideoView.setVideoPath(file.getPath());        provideoView.start();        timerPro.schedule(timerTaskPro,0,100);    }    public void feetChange() {        sizeLeft = 0;        sizeRight = 0;        timerTask = new TimerTask() {            @Override            public void run() {                index++;                setImageSize(0);            }        };        timer = new Timer();    }    public void setImageSize(int isPro) {        if(isPro == 0){            Message msg = handler.obtainMessage();            handler.sendMessage(msg);        }        else if(isPro == 1){            Message msg = handler2.obtainMessage();            handler2.sendMessage(msg);        }    }    final Handler handler2 = new Handler()      // 프로 발모양 핸들러    {        public void handleMessage(Message msg) {            if (indexPro < pro_left_weight.size()) {                Log.v("result : ", String.valueOf(indexPro));                sizeLeftPro = pro_left_weight.get(indexPro);                sizeRightPro = pro_right_weight.get(indexPro);                int px_lw = (int) TypedValue.applyDimension(TypedValue.COMPLEX_UNIT_DIP, (float) (sizeLeftPro * 0.4 + 30), getApplicationContext().getResources().getDisplayMetrics());                paramsL = new LinearLayout.LayoutParams(px_lw, px_lw * 2);                imgLeftPro.setLayoutParams(paramsL);                int px_rw = (int) TypedValue.applyDimension(TypedValue.COMPLEX_UNIT_DIP, (float) (sizeRightPro * 0.4 + 30), getApplicationContext().getResources().getDisplayMetrics());                paramsR = new LinearLayout.LayoutParams(px_rw, px_rw * 2);                imgRightPro.setLayoutParams(paramsR);                textLeftPro.setText(String.valueOf(sizeLeftPro));                textRightPro.setText(String.valueOf(sizeRightPro));            } else {                timerPro.cancel();            }        }    };    final Handler handler = new Handler()       // 일반 발모양    {        public void handleMessage(Message msg)        {            if(FLAG == 0){                if(index < left_weight.size()){                    sizeLeft = left_weight.get(index);                    sizeRight = right_weight.get(index);                    int px_lw = (int) TypedValue.applyDimension(TypedValue.COMPLEX_UNIT_DIP,(float)(sizeLeft*0.4+40), getApplicationContext().getResources().getDisplayMetrics());                    paramsL = new LinearLayout.LayoutParams(px_lw, px_lw*2);                    imgLeft.setLayoutParams(paramsL);                    int px_rw = (int) TypedValue.applyDimension(TypedValue.COMPLEX_UNIT_DIP,(float)(sizeRight*0.4+40), getApplicationContext().getResources().getDisplayMetrics());                    paramsR = new LinearLayout.LayoutParams(px_rw, px_rw*2);                    imgRight.setLayoutParams(paramsR);                    if(index % 2 == 0){                        textLeft.setText(String.valueOf(sizeLeft));                        textRight.setText(String.valueOf(sizeRight));                    }                }                else{                    timer.cancel();                }            }            else if(FLAG == REPEAT){                if(index < SEQ*10){                    Log.v("FOOT : ",String.valueOf(index));                    sizeLeft = left_weight.get(index);                    sizeRight = right_weight.get(index);                    int px_lw = (int) TypedValue.applyDimension(TypedValue.COMPLEX_UNIT_DIP,(float)(sizeLeft*0.4+40), getApplicationContext().getResources().getDisplayMetrics());                    paramsL = new LinearLayout.LayoutParams(px_lw, px_lw*2);                    imgLeft.setLayoutParams(paramsL);                    int px_rw = (int) TypedValue.applyDimension(TypedValue.COMPLEX_UNIT_DIP,(float)(sizeRight*0.4+40), getApplicationContext().getResources().getDisplayMetrics());                    paramsR = new LinearLayout.LayoutParams(px_rw, px_rw*2);                    imgRight.setLayoutParams(paramsR);//                    if(index % 2 == 0){                    textLeft.setText(String.valueOf(sizeLeft));                    textRight.setText(String.valueOf(sizeRight));//                    }                }                else{                    timer.cancel();                }            }        }    };    public void onClickClose(View view) {        provideoView.setVisibility(INVISIBLE);        videoView.setVisibility(VISIBLE);        main_layout.setAlpha((float) 1.0);        linear_video.setVisibility(INVISIBLE);        video_layout.setVisibility(INVISIBLE);        videoView.start();    }}